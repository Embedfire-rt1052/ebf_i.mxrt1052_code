/**
  ******************************************************************
  * @file    bsp_OV2640_config.c
  * @author  fire
  * @version V1.0
  * @date    2019-xx-xx
  * @brief   摄像头驱动
  ******************************************************************
  * @attention
  *
  * 实验平台:野火  i.MXRT1052开发板 
  * 论坛    :http://www.firebbs.cn
  * 淘宝    :http://firestm32.taobao.com
  *
  ******************************************************************
  */
#include "fsl_video_common.h"
#include "fsl_camera.h"
#include "fsl_camera_device.h"
#include "bsp_ov2640_config.h"
#include "bsp_ov2640.h"


/* Private macro -------------------------------------------------------------*/
/* Private variables ---------------------------------------------------------*/
/* QQVGA 160x120 */
const char OV2640_QQVGA[][2]=
{
  0xff, 0x00,
  0x2c, 0xff,
  0x2e, 0xdf,
  0xff, 0x01,
  0x3c, 0x32,
  0x11, 0x00,
  0x09, 0x02,
  0x03, 0xcf,
  0x04, 0x08,
  0x13, 0xe5,
  0x14, 0x48,
  0x2c, 0x0c,
  0x33, 0x78,
  0x3a, 0x33,
  0x3b, 0xfb,
  0x3e, 0x00,
  0x43, 0x11,
  0x16, 0x10,
  0x39, 0x02,
  0x35, 0x88,
  0x22, 0x0a,
  0x37, 0x40,
  0x23, 0x00,
  0x34, 0xa0,
  0x36, 0x1a,
  0x06, 0x02,
  0x07, 0xc0,
  0x0d, 0xb7,
  0x0e, 0x01,
  0x4c, 0x00,
  0x4a, 0x81,
  0x21, 0x99,
  0x24, 0x3a,
  0x25, 0x32,
  0x26, 0x82,
  0x5c, 0x00,
  0x63, 0x00,
  0x5d, 0x55,
  0x5e, 0x7d,
  0x5f, 0x7d,
  0x60, 0x55,
  0x61, 0x70,
  0x62, 0x80,
  0x7c, 0x05,
  0x20, 0x80,
  0x28, 0x30,
  0x6c, 0x00,
  0x6d, 0x80,
  0x6e, 0x00,
  0x70, 0x02,
  0x71, 0x96,
  0x73, 0xe1,
  0x3d, 0x34,
  0x5a, 0x57,
  0x4f, 0xbb,
  0x50, 0x9c,
  0x0f, 0x43,
  0xff, 0x00,
  0xe5, 0x7f,
  0xf9, 0xc0,
  0x41, 0x24,
  0xe0, 0x14,
  0x76, 0xff,
  0x33, 0xa0,
  0x42, 0x20,
  0x43, 0x18,
  0x4c, 0x00,
  0x87, 0xd0,
  0x88, 0x3f,
  0xd7, 0x03,
  0xd9, 0x10,
  0xd3, 0x82,
  0xc8, 0x08,
  0xc9, 0x80,
  0x7c, 0x00,
  0x7d, 0x02,
  0x7c, 0x03,
  0x7d, 0x48,
  0x7d, 0x48,
  0x7c, 0x08,
  0x7d, 0x20,
  0x7d, 0x10,
  0x7d, 0x0e,
  0x90, 0x00,
  0x91, 0x0e,
  0x91, 0x1a,
  0x91, 0x31,
  0x91, 0x5a,
  0x91, 0x69,
  0x91, 0x75,
  0x91, 0x7e,
  0x91, 0x88,
  0x91, 0x8f,
  0x91, 0x96,
  0x91, 0xa3,
  0x91, 0xaf,
  0x91, 0xc4,
  0x91, 0xd7,
  0x91, 0xe8,
  0x91, 0x20,
  0x92, 0x00,
  0x93, 0x06,
  0x93, 0xe3,
  0x93, 0x05,
  0x93, 0x05,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x96, 0x00,
  0x97, 0x08,
  0x97, 0x19,
  0x97, 0x02,
  0x97, 0x0c,
  0x97, 0x24,
  0x97, 0x30,
  0x97, 0x28,
  0x97, 0x26,
  0x97, 0x02,
  0x97, 0x98,
  0x97, 0x80,
  0x97, 0x00,
  0x97, 0x00,
  0xc3, 0xed,
  0xa4, 0x00,
  0xa8, 0x00,
  0xbf, 0x00,
  0xba, 0xf0,
  0xbc, 0x64,
  0xbb, 0x02,
  0xb6, 0x3d,
  0xb8, 0x57,
  0xb7, 0x38,
  0xb9, 0x4e,
  0xb3, 0xe8,
  0xb4, 0xe1,
  0xb5, 0x66,
  0xb0, 0x67,
  0xb1, 0x5e,
  0xb2, 0x04,
  0xc7, 0x00,
  0xc6, 0x51,
  0xc5, 0x11,
  0xc4, 0x9c,
  0xcf, 0x02,
  0xa6, 0x00,
  0xa7, 0xe0,
  0xa7, 0x10,
  0xa7, 0x1e,
  0xa7, 0x21,
  0xa7, 0x00,
  0xa7, 0x28,
  0xa7, 0xd0,
  0xa7, 0x10,
  0xa7, 0x16,
  0xa7, 0x21,
  0xa7, 0x00,
  0xa7, 0x28,
  0xa7, 0xd0,
  0xa7, 0x10,
  0xa7, 0x17,
  0xa7, 0x21,
  0xa7, 0x00,
  0xa7, 0x28,
  0xc0, 0xc8,
  0xc1, 0x96,
  0x86, 0x1d,
  0x50, 0x00,
  0x51, 0x90,
  0x52, 0x18,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x88,
  0x57, 0x00,
  0x5a, 0x90,
  0x5b, 0x18,
  0x5c, 0x05,
  0xc3, 0xef,
  0x7f, 0x00,
  0xda, 0x00,
  0xe5, 0x1f,
  0xe1, 0x67,
  0xe0, 0x00,
  0xdd, 0xff,
  0x05, 0x00,
  0xff, 0x01,
  0xff, 0x01,
  0x12, 0x00,
  0x17, 0x11,
  0x18, 0x75,
  0x19, 0x01,
  0x1a, 0x97,
  0x32, 0x36,
  0x4f, 0xbb,
  0x6d, 0x80,
  0x3d, 0x34,
  0x39, 0x02,
  0x35, 0x88,
  0x22, 0x0a,
  0x37, 0x40,
  0x23, 0x00,
  0x34, 0xa0,
  0x36, 0x1a,
  0x06, 0x02,
  0x07, 0xc0,
  0x0d, 0xb7,
  0x0e, 0x01,
  0x4c, 0x00,
  0xff, 0x00,
  0xe0, 0x04,
  0x8c, 0x00,
  0x87, 0xd0,
  0xe0, 0x00,
  0xff, 0x00,
  0xe0, 0x14,
  0xe1, 0x77,
  0xe5, 0x1f,
  0xd7, 0x03,
  0xda, 0x10,
  0xe0, 0x00,
  0xff, 0x00,
  0xe0, 0x04,
  0xc0, 0xc8,
  0xc1, 0x96,
  0x86, 0x1d,
  0x50, 0x00,
  0x51, 0x90,
  0x52, 0x2c,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x88,
  0x57, 0x00,
  0x5a, 0x90,
  0x5b, 0x2c,
  0x5c, 0x05,
  0xe0, 0x00,
  0xd3, 0x04,
  0xff, 0x00,
  0xc3, 0xef,
  0xa6, 0x00,
  0xa7, 0xdd,
  0xa7, 0x78,
  0xa7, 0x7e,
  0xa7, 0x24,
  0xa7, 0x00,
  0xa7, 0x25,
  0xa6, 0x06,
  0xa7, 0x20,
  0xa7, 0x58,
  0xa7, 0x73,
  0xa7, 0x34,
  0xa7, 0x00,
  0xa7, 0x25,
  0xa6, 0x0c,
  0xa7, 0x28,
  0xa7, 0x58,
  0xa7, 0x6d,
  0xa7, 0x34,
  0xa7, 0x00,
  0xa7, 0x25,
  0xff, 0x00,
  0xe0, 0x04,
  0xe1, 0x67,
  0xe5, 0x1f,
  0xd7, 0x01,
  0xda, 0x08,
  0xda, 0x09,
  0xe0, 0x00,
  0x98, 0x00,
  0x99, 0x00,
  0xff, 0x01,
  0x04, 0x28,
  0xff, 0x01,
  0x12, 0x40,
  0x17, 0x11,
  0x18, 0x43,
  0x19, 0x00,
  0x1a, 0x4b,
  0x32, 0x09,
  0x4f, 0xca,
  0x50, 0xa8,
  0x5a, 0x23,
  0x6d, 0x00,
  0x39, 0x12,
  0x35, 0xda,
  0x22, 0x1a,
  0x37, 0xc3,
  0x23, 0x00,
  0x34, 0xc0,
  0x36, 0x1a,
  0x06, 0x88,
  0x07, 0xc0,
  0x0d, 0x87,
  0x0e, 0x41,
  0x4c, 0x00,
  0xff, 0x00,
  0xe0, 0x04,
  0xc0, 0x64,
  0xc1, 0x4b,
  0x86, 0x35,
  0x50, 0x92,
  0x51, 0xc8,
  0x52, 0x96,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x00,
  0x57, 0x00,
  0x5a, 0x28,
  0x5b, 0x1e,
  0x5c, 0x00,
  0xe0, 0x00,
  0xff, 0x01,
  0x11, 0x00,
  0x3d, 0x38,
  0x2d, 0x00,
  0x50, 0x65,
  0xff, 0x00,
  0xd3, 0x04,
  0x7c, 0x00,
  0x7d, 0x04,
  0x7c, 0x09,
  0x7d, 0x28,
  0x7d, 0x00,
};

/* OV2640的 SVGA是 600列*800行的，在800列*480行的液晶屏上不能全屏*/
/* 所以直接用 UXGA 模式，再根据所需的图像窗口裁剪 */
const unsigned char OV2640_UXGA[][2]=
{
  0xff, 0x00,
  0x2c, 0xff,
  0x2e, 0xdf,
  0xff, 0x01,
  0x3c, 0x32,
  0x11, 0x00,
  0x09, 0x02,
  0x04, 0x20|0x80,	//水平翻转
  0x13, 0xe5,
  0x14, 0x48,
  0x2c, 0x0c,
  0x33, 0x78,
  0x3a, 0x33,
  0x3b, 0xfB,
  0x3e, 0x00,
  0x43, 0x11,
  0x16, 0x10,
  0x4a, 0x81,
  0x21, 0x99,
  0x24, 0x40,
  0x25, 0x38,
  0x26, 0x82,
  0x5c, 0x00,
  0x63, 0x00,
  0x46, 0x3f,
  0x0c, 0x3c,
  0x61, 0x70,
  0x62, 0x80,
  0x7c, 0x05,
  0x20, 0x80,
  0x28, 0x30,
  0x6c, 0x00,
  0x6d, 0x80,
  0x6e, 0x00,
  0x70, 0x02,
  0x71, 0x94,
  0x73, 0xc1,
  0x3d, 0x34,
  0x5a, 0x57,
  0x12, 0x00,
  0x11, 0x00,
  0x17, 0x11,
  0x18, 0x75,
  0x19, 0x01,
  0x1a, 0x97,
  0x32, 0x36,
  0x03, 0x0f,
  0x37, 0x40,
  0x4f, 0xbb,
  0x50, 0x9c,
  0x5a, 0x57,
  0x6d, 0x80,
  0x6d, 0x38,
  0x39, 0x02,
  0x35, 0x88,
  0x22, 0x0a,
  0x37, 0x40,
  0x23, 0x00,
  0x34, 0xa0,
  0x36, 0x1a,
  0x06, 0x02,
  0x07, 0xc0,
  0x0d, 0xb7,
  0x0e, 0x01,
  0x4c, 0x00,
  0xff, 0x00,
  0xe5, 0x7f,
  0xf9, 0xc0,
  0x41, 0x24,
  0xe0, 0x14,
  0x76, 0xff,
  0x33, 0xa0,
  0x42, 0x20,
  0x43, 0x18,
  0x4c, 0x00,
  0x87, 0xd0,
  0x88, 0x3f,
  0xd7, 0x03,
  0xd9, 0x10,
  0xd3, 0x82,
  0xc8, 0x08,
  0xc9, 0x80,
  0x7d, 0x00,
  0x7c, 0x03,
  0x7d, 0x48,
  0x7c, 0x08,
  0x7d, 0x20,
  0x7d, 0x10,
  0x7d, 0x0e,
  0x90, 0x00,
  0x91, 0x0e,
  0x91, 0x1a,
  0x91, 0x31,
  0x91, 0x5a,
  0x91, 0x69,
  0x91, 0x75,
  0x91, 0x7e,
  0x91, 0x88,
  0x91, 0x8f,
  0x91, 0x96,
  0x91, 0xa3,
  0x91, 0xaf,
  0x91, 0xc4,
  0x91, 0xd7,
  0x91, 0xe8,
  0x91, 0x20,
  0x92, 0x00,
  0x93, 0x06,
  0x93, 0xe3,
  0x93, 0x02,
  0x93, 0x02,
  0x93, 0x00,
  0x93, 0x04,
  0x93, 0x00,
  0x93, 0x03,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x96, 0x00,
  0x97, 0x08,
  0x97, 0x19,
  0x97, 0x02,
  0x97, 0x0c,
  0x97, 0x24,
  0x97, 0x30,
  0x97, 0x28,
  0x97, 0x26,
  0x97, 0x02,
  0x97, 0x98,
  0x97, 0x80,
  0x97, 0x00,
  0x97, 0x00,
  0xc3, 0xef,
  0xff, 0x00,
  0xba, 0xdc,
  0xbb, 0x08,
  0xb6, 0x24,
  0xb8, 0x33,
  0xb7, 0x20,
  0xb9, 0x30,
  0xb3, 0xb4,
  0xb4, 0xca,
  0xb5, 0x43,
  0xb0, 0x5c,
  0xb1, 0x4f,
  0xb2, 0x06,
  0xc7, 0x00,
  0xc6, 0x51,
  0xc5, 0x11,
  0xc4, 0x9c,
  0xbf, 0x00,
  0xbc, 0x64,
  0xa6, 0x00,
  0xa7, 0x1e,
  0xa7, 0x6b,
  0xa7, 0x47,
  0xa7, 0x33,
  0xa7, 0x00,
  0xa7, 0x23,
  0xa7, 0x2e,
  0xa7, 0x85,
  0xa7, 0x42,
  0xa7, 0x33,
  0xa7, 0x00,
  0xa7, 0x23,
  0xa7, 0x1b,
  0xa7, 0x74,
  0xa7, 0x42,
  0xa7, 0x33,
  0xa7, 0x00,
  0xa7, 0x23,
  0xc0, 0xc8,
  0xc1, 0x96,
  0x8c, 0x00,
  0x86, 0x3d,
  0x50, 0x92,
  0x51, 0x90,
  0x52, 0x2c,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x88,
  0x5a, 0x50,
  0x5b, 0x3c,
  0x5c, 0x00,
  0xd3, 0x04,
  0x7f, 0x00,
  0xda, 0x00,
  0xe5, 0x1f,
  0xe1, 0x67,
  0xe0, 0x00,
  0xdd, 0x7f,
  0x05, 0x00,
  0xff, 0x00,
  0xe0, 0x04,
  0xc0, 0xc8,
  0xc1, 0x96,
  0x86, 0x3d,
  0x50, 0x92,
  0x51, 0x90,
  0x52, 0x2c,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x88,
  0x57, 0x00,
  0x5a, 0x50,
  0x5b, 0x3c,
  0x5c, 0x00,
  0xd3, 0x04,
  0xe0, 0x00,
  0xFF, 0x00,
  0x05, 0x00,
  0xDA, 0x08,
  0xda, 0x09,
  0x98, 0x00,
  0x99, 0x00,
  0x00, 0x00,
	

  
//  0xff, 0x00,
//  0xe0, 0x04,
//  0xc0, 0xc8,
//  0xc1, 0x96,
//  0x86, 0x35,
//  0x50, 0x80,//必须配置这个寄存器控制时钟
//  0x51, 0x90,
//  0x52, 0x2c,
//  0x53, 0x00,
//  0x54, 0x00,
//  0x55, 0x88,
//  0x57, 0x00,
//  0x5a, 0x78,//480
//  0x5b, 0x44,//272
//  0x5c, 0x00,
//  0xd3, 0x04,
//  0xe0, 0x00,
};

const unsigned char OV2640_JPEG_INIT[][2]=
{
  0xff, 0x00,
  0x2c, 0xff,
  0x2e, 0xdf,
  0xff, 0x01,
  0x3c, 0x32,
  0x11, 0x30,
  0x09, 0x02,
  0x04, 0x28,
  0x13, 0xe5,
  0x14, 0x48,
  0x2c, 0x0c,
  0x33, 0x78,
  0x3a, 0x33,
  0x3b, 0xfB,
  0x3e, 0x00,
  0x43, 0x11,
  0x16, 0x10,
  0x39, 0x92,
  0x35, 0xda,
  0x22, 0x1a,
  0x37, 0xc3,
  0x23, 0x00,
  0x34, 0xc0,
  0x36, 0x1a,
  0x06, 0x88,
  0x07, 0xc0,
  0x0d, 0x87,
  0x0e, 0x41,
  0x4c, 0x00,
  0x48, 0x00,
  0x5B, 0x00,
  0x42, 0x03,
  0x4a, 0x81,
  0x21, 0x99,
  0x24, 0x40,
  0x25, 0x38,
  0x26, 0x82,
  0x5c, 0x00,
  0x63, 0x00,
  0x61, 0x70,
  0x62, 0x80,
  0x7c, 0x05,
  0x20, 0x80,
  0x28, 0x30,
  0x6c, 0x00,
  0x6d, 0x80,
  0x6e, 0x00,
  0x70, 0x02,
  0x71, 0x94,
  0x73, 0xc1,
  0x12, 0x40,
  0x17, 0x11,
  0x18, 0x43,
  0x19, 0x00,
  0x1a, 0x4b,
  0x32, 0x09,
  0x37, 0xc0,
  0x4f, 0x60,
  0x50, 0xa8,
  0x6d, 0x00,
  0x3d, 0x38,
  0x46, 0x3f,
  0x4f, 0x60,
  0x0c, 0x3c,
  0xff, 0x00,
  0xe5, 0x7f,
  0xf9, 0xc0,
  0x41, 0x24,
  0xe0, 0x14,
  0x76, 0xff,
  0x33, 0xa0,
  0x42, 0x20,
  0x43, 0x18,
  0x4c, 0x00,
  0x87, 0xd5,
  0x88, 0x3f,
  0xd7, 0x03,
  0xd9, 0x10,
  0xd3, 0x82,
  0xc8, 0x08,
  0xc9, 0x80,
  0x7c, 0x00,
  0x7d, 0x00,
  0x7c, 0x03,
  0x7d, 0x48,
  0x7d, 0x48,
  0x7c, 0x08,
  0x7d, 0x20,
  0x7d, 0x10,
  0x7d, 0x0e,
  0x90, 0x00,
  0x91, 0x0e,
  0x91, 0x1a,
  0x91, 0x31,
  0x91, 0x5a,
  0x91, 0x69,
  0x91, 0x75,
  0x91, 0x7e,
  0x91, 0x88,
  0x91, 0x8f,
  0x91, 0x96,
  0x91, 0xa3,
  0x91, 0xaf,
  0x91, 0xc4,
  0x91, 0xd7,
  0x91, 0xe8,
  0x91, 0x20,
  0x92, 0x00,
  0x93, 0x06,
  0x93, 0xe3,
  0x93, 0x05,
  0x93, 0x05,
  0x93, 0x00,
  0x93, 0x04,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x93, 0x00,
  0x96, 0x00,
  0x97, 0x08,
  0x97, 0x19,
  0x97, 0x02,
  0x97, 0x0c,
  0x97, 0x24,
  0x97, 0x30,
  0x97, 0x28,
  0x97, 0x26,
  0x97, 0x02,
  0x97, 0x98,
  0x97, 0x80,
  0x97, 0x00,
  0x97, 0x00,
  0xc3, 0xed,
  0xa4, 0x00,
  0xa8, 0x00,
  0xc5, 0x11,
  0xc6, 0x51,
  0xbf, 0x80,
  0xc7, 0x10,
  0xb6, 0x66,
  0xb8, 0xA5,
  0xb7, 0x64,
  0xb9, 0x7C,
  0xb3, 0xaf,
  0xb4, 0x97,
  0xb5, 0xFF,
  0xb0, 0xC5,
  0xb1, 0x94,
  0xb2, 0x0f,
  0xc4, 0x5c,
  0xc0, 0x64,
  0xc1, 0x4B,
  0x8c, 0x00,
  0x86, 0x3D,
  0x50, 0x00,
  0x51, 0xC8,
  0x52, 0x96,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x00,
  0x5a, 0xC8,
  0x5b, 0x96,
  0x5c, 0x00,
  0xd3, 0x7f,
  0xc3, 0xed,
  0x7f, 0x00,
  0xda, 0x00,
  0xe5, 0x1f,
  0xe1, 0x67,
  0xe0, 0x00,
  0xdd, 0x7f,
  0x05, 0x00,

  0x12, 0x40,
  0xd3, 0x7f,
  0xc0, 0x16,
  0xC1, 0x12,
  0x8c, 0x00,
  0x86, 0x3d,
  0x50, 0x00,
  0x51, 0x2C,
  0x52, 0x24,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x00,
  0x5A, 0x2c,
  0x5b, 0x24,
  0x5c, 0x00,
};

const unsigned char OV2640_YUV422[][2]= 
{
  0xFF, 0x00,
  0x05, 0x00,
  0xDA, 0x10,
  0xD7, 0x03,
  0xDF, 0x00,
  0x33, 0x80,
  0x3C, 0x40,
  0xe1, 0x77,
  0x00, 0x00,
};

const unsigned char OV2640_JPEG[][2]=
{
  0xe0, 0x14,
  0xe1, 0x77,
  0xe5, 0x1f,
  0xd7, 0x03,
  0xda, 0x10,
  0xe0, 0x00,
  0xFF, 0x01,
  0x04, 0x08,
};

/* JPG 160x120 */
const unsigned char OV2640_160x120_JPEG[][2]=
{
  0xff, 0x01,
  0x12, 0x40,
  0x17, 0x11,
  0x18, 0x43,
  0x19, 0x00,
  0x1a, 0x4b,
  0x32, 0x09,
  0x4f, 0xca,
  0x50, 0xa8,
  0x5a, 0x23,
  0x6d, 0x00,
  0x39, 0x12,
  0x35, 0xda,
  0x22, 0x1a,
  0x37, 0xc3,
  0x23, 0x00,
  0x34, 0xc0,
  0x36, 0x1a,
  0x06, 0x88,
  0x07, 0xc0,
  0x0d, 0x87,
  0x0e, 0x41,
  0x4c, 0x00,
  0xff, 0x00,
  0xe0, 0x04,
  0xc0, 0x64,
  0xc1, 0x4b,
  0x86, 0x35,
  0x50, 0x92,
  0x51, 0xc8,
  0x52, 0x96,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x00,
  0x57, 0x00,
  0x5a, 0x28,
  0x5b, 0x1e,
  0x5c, 0x00,
  0xe0, 0x00,
};

/* JPG, 0x176x144 */
const unsigned char OV2640_176x144_JPEG[][2]=
{
  0xff, 0x01,
  0x12, 0x40,
  0x17, 0x11,
  0x18, 0x43,
  0x19, 0x00,
  0x1a, 0x4b,
  0x32, 0x09,
  0x4f, 0xca,
  0x50, 0xa8,
  0x5a, 0x23,
  0x6d, 0x00,
  0x39, 0x12,
  0x35, 0xda,
  0x22, 0x1a,
  0x37, 0xc3,
  0x23, 0x00,
  0x34, 0xc0,
  0x36, 0x1a,
  0x06, 0x88,
  0x07, 0xc0,
  0x0d, 0x87,
  0x0e, 0x41,
  0x4c, 0x00,
  0xff, 0x00,
  0xe0, 0x04,
  0xc0, 0x64,
  0xc1, 0x4b,
  0x86, 0x35,
  0x50, 0x92,
  0x51, 0xc8,
  0x52, 0x96,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x00,
  0x57, 0x00,
  0x5a, 0x2c,
  0x5b, 0x24,
  0x5c, 0x00,
  0xe0, 0x00,
};

/* JPG 320x240 */
const unsigned char OV2640_320x240_JPEG[][2]=
{
  0xff, 0x01,
  0x12, 0x40,
  0x17, 0x11,
  0x18, 0x43,
  0x19, 0x00,
  0x1a, 0x4b,
  0x32, 0x09,
  0x4f, 0xca,
  0x50, 0xa8,
  0x5a, 0x23,
  0x6d, 0x00,
  0x39, 0x12,
  0x35, 0xda,
  0x22, 0x1a,
  0x37, 0xc3,
  0x23, 0x00,
  0x34, 0xc0,
  0x36, 0x1a,
  0x06, 0x88,
  0x07, 0xc0,
  0x0d, 0x87,
  0x0e, 0x41,
  0x4c, 0x00,
  0xff, 0x00,
  0xe0, 0x04,
  0xc0, 0x64,
  0xc1, 0x4b,
  0x86, 0x35,
  0x50, 0x89,
  0x51, 0xc8,
  0x52, 0x96,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x00,
  0x57, 0x00,
  0x5a, 0x50,
  0x5b, 0x3c,
  0x5c, 0x00,
  0xe0, 0x00,
};

/* JPG 352x288 */
const unsigned char OV2640_352x288_JPEG[][2]=
{
  0xff, 0x01,
  0x12, 0x40,
  0x17, 0x11,
  0x18, 0x43,
  0x19, 0x00,
  0x1a, 0x4b,
  0x32, 0x09,
  0x4f, 0xca,
  0x50, 0xa8,
  0x5a, 0x23,
  0x6d, 0x00,
  0x39, 0x12,
  0x35, 0xda,
  0x22, 0x1a,
  0x37, 0xc3,
  0x23, 0x00,
  0x34, 0xc0,
  0x36, 0x1a,
  0x06, 0x88,
  0x07, 0xc0,
  0x0d, 0x87,
  0x0e, 0x41,
  0x4c, 0x00,
  0xff, 0x00,
  0xe0, 0x04,
  0xc0, 0x64,
  0xc1, 0x4b,
  0x86, 0x35,
  0x50, 0x89,
  0x51, 0xc8,
  0x52, 0x96,
  0x53, 0x00,
  0x54, 0x00,
  0x55, 0x00,
  0x57, 0x00,
  0x5a, 0x58,
  0x5b, 0x48,
  0x5c, 0x00,
  0xe0, 0x00,
};

/* Private function prototypes -----------------------------------------------*/
/* Private functions ---------------------------------------------------------*/


///*******************************************************************************
// * Code
// ******************************************************************************/

static void OV2640_DelayMs(uint32_t ms)
{

	while (ms--)
	{
		for (volatile int i = 0U; i < 10000000U; i++)
		{
			__ASM("nop");
		}
	}
}

/*******************************************************************************
 * Prototypes
 ******************************************************************************/

status_t OV2640_Init(camera_device_handle_t *handle, const camera_config_t *config);

status_t OV2640_InitExt(camera_device_handle_t *handle, const camera_config_t *config, const void *specialConfig);

status_t OV2640_Start(camera_device_handle_t *handle);

status_t OV2640_Stop(camera_device_handle_t *handle);

/*******************************************************************************
 * Variables
 ******************************************************************************/
const camera_device_operations_t ov2640_ops = {
    .init = 		OV2640_Init,
    .start = 		OV2640_Start,
    .stop = 		OV2640_Stop,
    .init_ext = OV2640_InitExt,
};



/**
  * @brief  设置帧率
  * @param  可使用宏：FRAME_RATE_30FPS，FRAME_RATE_15FPS
  * @retval 无
  */
void OV2640_FrameRate_Set(uint8_t frame_rate)
{ 
//		if(frame_rate == FRAME_RATE_30FPS)
//		{
//			OV2640_WriteReg(LPI2C1,0x3035,0x21);//X_ADDR_ST高字节
//			OV2640_WriteReg(LPI2C1,0x3036,0x72);//X_ADDR_ST低字节	
//		}
//		else if(frame_rate == FRAME_RATE_15FPS)
//		{
//			OV2640_WriteReg(LPI2C1,0x3035,0x41);//X_ADDR_ST高字节
//			OV2640_WriteReg(LPI2C1,0x3036,0x72);//X_ADDR_ST低字节	
//		}
	
}

/**
  * @brief  设置ISP图像大小，即ISP图像在传感器中的窗口
  *         较小的ISP图像可以提高图像采集频率(还要设置时钟)
  * @param  x_st,y_st：起始位置偏移
	* @param  width，height: 宽度，高度
  * @note   x_st+width <= 2592,y_st+height <= 1944
  * @retval 无
  */
void OV2640_ISPSize_Set(uint16_t x_st,uint16_t y_st,uint16_t width,uint16_t height)
{ 
		//  OV2640_WriteReg(LPI2C1,0X3212,0X03);  	

		OV2640_WriteReg(LPI2C1,0x3800,x_st>>8);		//X_ADDR_ST高字节
		OV2640_WriteReg(LPI2C1,0x3801,x_st&0xff);//X_ADDR_ST低字节	
		OV2640_WriteReg(LPI2C1,0x3802,y_st>>8);		//Y_ADDR_ST高字节
		OV2640_WriteReg(LPI2C1,0x3803,y_st&0xff);//Y_ADDR_ST低字节OV2640_WriteReg(LPI2C1,0x3804,(x_st+width)>>8);		//X_ADDR_END高字节
		OV2640_WriteReg(LPI2C1,0x3805,(x_st+width)&0xff);	//X_ADDR_END低字节	
		OV2640_WriteReg(LPI2C1,0x3806,(y_st+height)>>8);		//Y_ADDR_END高字节
		OV2640_WriteReg(LPI2C1,0x3807,(y_st+height)&0xff);//Y_ADDR_END低字节

		//  OV2640_WriteReg(LPI2C1,0X3212,0X13);		
		//  OV2640_WriteReg(LPI2C1,0X3212,0Xa3);		
}





/**
  * @brief  设置图像输出像大小，位置，以及是否使用自动缩放功能
  * @param  scaling:0,关闭自动缩放功能，1，开启自动缩放功能
  * @param  x_off,y_off:-关闭自动缩放功能时，这两个值为输出窗口在ISP图像中的偏移。
												 ！！不使用自动缩放功能时，非常容易出错。

                         ！！使用15fps相对不容易出错，但还是推荐使用自动缩放功能。

                        -开启自动缩放功能时，这两个值设置为 16,4 一般能正常使用，
                        也可根据输出窗口的宽高比例来调整，比较复杂，
                        请参考《OV2640 自动对焦摄像模组应用指南》第46页
  * @param  width,height:图像宽度和图像高度
  * @retval 无
  */
void OV2640_OutSize_Set(uint8_t scaling,uint16_t x_off,uint16_t y_off,uint16_t width,uint16_t height)
{ 
		uint8_t reg_temp;

		//读取原寄存器内容
		//		reg_temp = OV2640_ReadReg(0x5001);
		OV2640_ReadReg(LPI2C1,0x5001,&reg_temp);	
		//不使用自动缩放功能
		if(scaling == 0 )
		{
			OV2640_WriteReg(LPI2C1,0x5001,reg_temp &~(1<<5) );	//scaling off		
		}
		else
		{
			OV2640_WriteReg(LPI2C1,0x5001,reg_temp|(1<<5) );	//scaling on		
		}	

		OV2640_WriteReg(LPI2C1,0x3810,x_off>>8);	//X offset高字节
		OV2640_WriteReg(LPI2C1,0x3811,x_off&0xff);//X offset低字节	
		OV2640_WriteReg(LPI2C1,0x3812,y_off>>8);	//Y offset高字节
		OV2640_WriteReg(LPI2C1,0x3813,y_off&0xff);//Y offset低字节


		OV2640_WriteReg(LPI2C1,0X3212,0X03);  	

		OV2640_WriteReg(LPI2C1,0x3808,width>>8);	//输出宽度高字节
		OV2640_WriteReg(LPI2C1,0x3809,width&0xff);//输出宽度低字节  
		OV2640_WriteReg(LPI2C1,0x380a,height>>8);//输出高度高字节
		OV2640_WriteReg(LPI2C1,0x380b,height&0xff);//输出高度低字节

		OV2640_WriteReg(LPI2C1,0X3212,0X13);		
		OV2640_WriteReg(LPI2C1,0X3212,0Xa3);		
}

//色彩饱和度参数表
const static uint8_t OV2640_Saturation_reg[][6]=
{ 
		0X0C,0x30,0X3D,0X3E,0X3D,0X01,//-3 
		0X10,0x3D,0X4D,0X4E,0X4D,0X01,//-2  
		0X15,0x52,0X66,0X68,0X66,0X02,//-1  
		0X1A,0x66,0X80,0X82,0X80,0X02,//0  
		0X1F,0x7A,0X9A,0X9C,0X9A,0X02,//+1  
		0X24,0x8F,0XB3,0XB6,0XB3,0X03,//+2
		0X2B,0xAB,0XD6,0XDA,0XD6,0X04,//+3
}; 


//曝光补偿设置参数表
const static uint8_t OV2640_Exposure_reg[][6]=
{
    0x10,0x08,0x10,0x08,0x20,0x10,//-3  
    0x20,0x18,0x41,0x20,0x18,0x10,//-2
    0x30,0x28,0x61,0x30,0x28,0x10,//-1 
    0x38,0x30,0x61,0x38,0x30,0x10,//0  
    0x40,0x38,0x71,0x40,0x38,0x10,//+1 
    0x50,0x48,0x90,0x50,0x48,0x20,//+2   
    0x60,0x58,0xa0,0x60,0x58,0x20,//+3    
};



/**未测试*/
/**
  * @brief  设置图像输出窗口
  * @param  sx,sy,起始地址
						width,height:宽度(对应:horizontal)和高度(对应:vertical)
  * @retval 0,设置成功， 其他,设置失败
  */
void OV2640_Window_Set(uint16_t sx,uint16_t sy,uint16_t width,uint16_t height)
{
//	uint16_t endx;
//	uint16_t endy;
//	uint8_t temp;
//	endx=sx+width/2;	//V*2
// 	endy=sy+height/2;

// 	OV2640_WriteReg(LPI2C1,0XFF,0X01);
//	//temp = OV2640_ReadReg(0X03);				//读取Vref之前的值
//	OV2640_ReadReg(LPI2C1,0X03,&temp);
//	
//	temp&=0XF0;
//	temp|=((endy&0X03)<<2)|(sy&0X03);
//	OV2640_WriteReg(LPI2C1,0X03,temp);			//设置Vref的start和end的最低2位
//	OV2640_WriteReg(LPI2C1,0X19,sy>>2);			//设置Vref的start高8位
//	OV2640_WriteReg(LPI2C1,0X1A,endy>>2);		//设置Vref的end的高8位

//	//temp = OV2640_ReadReg(0X32);					//读取Href之前的值
//	OV2640_ReadReg(LPI2C1,0X32,&temp);
//	
//	temp&=0XC0;
//	temp|=((endx&0X07)<<3)|(sx&0X07);
//	OV2640_WriteReg(LPI2C1,0X32,temp);				//设置Href的start和end的最低3位
//	OV2640_WriteReg(LPI2C1,0X17,sx>>3);			//设置Href的start高8位
//	OV2640_WriteReg(LPI2C1,0X18,endx>>3);			//设置Href的end的高8位
}

/**
  * @brief  设置相机模式
  * @param  None        	
  * @retval None
  */
//OV2640_MODE_PARAM Set_Cam_mode(int temp)
//{
////	OV2640_MODE_PARAM mode;
//////	/*	只需在这里修改传参，即可修改参数，详细参数详见结构体	*/
//////	switch(temp)
//////	{
//////		case 1:	cam_temp_mode=cam_mode_240_320;break;
//////		case 2:	cam_temp_mode=cam_mode_640_480;break;
//////		case 3:	cam_temp_mode=cam_mode_800_480;break;
//////	}
////	mode=cam_temp_mode;
//	return 1;
//}

/**
  * @brief  使用cammode参数初始化各项配置
  * @param  None        	
  * @retval None
  */
void OV2640_USER_Config(void)
{	

//		OV2640_FrameRate_Set(cam_temp_mode.frame_rate);
//		OV2640_DelayMs(1);

//		OV2640_ISPSize_Set(cam_temp_mode.cam_isp_sx,       	//摄像头ISP X起始位置
//												 cam_temp_mode.cam_isp_sy,     	//摄像头ISP Y起始位置
//												 cam_temp_mode.cam_isp_width,   	//摄像头ISP 宽
//												 cam_temp_mode.cam_isp_height);  //摄像头ISP 高
//		OV2640_DelayMs(1);
//		/*	设置图像输出像大小，位置，以及是否使用自动缩放功能	*/
//		OV2640_OutSize_Set(cam_temp_mode.scaling,						//是否使用自动缩放
//													cam_temp_mode.cam_out_sx,      //摄像头输出窗口X起始位置
//													cam_temp_mode.cam_out_sy,      //摄像头输出窗口Y起始位置
//													cam_temp_mode.cam_out_width,   //输出图像分辨率，宽
//													cam_temp_mode.cam_out_height); //输出图像分辨率，高
//	
//		OV2640_DelayMs(1);
//		OV2640_BrightnessConfig(cam_temp_mode.brightness);		//光照度，
//		OV2640_DelayMs(1);

//		OV2640_Color_Saturation(cam_temp_mode.saturation);		//饱和度
//		OV2640_DelayMs(1);

//		OV2640_ContrastConfig(cam_temp_mode.contrast);				//对比度
//		OV2640_DelayMs(1);

//		OV2640_Exposure(cam_temp_mode.exposure);							//曝光补偿
//		OV2640_DelayMs(1);

//		OV2640_LightMode(cam_temp_mode.light_mode);					//光照模式
//		OV2640_DelayMs(1);

//		OV2640_SpecialEffects(cam_temp_mode.effect);					//特殊效果
//		OV2640_DelayMs(1);


}



//static status_t OV2640_WriteRegs(sccb_i2c_t i2c, const OV2640_reg_t regs[], uint32_t num)
//{
////    status_t status = kStatus_Success;

////    for (uint32_t i = 0; i < num; i++)
////    {	
////        status = OV2640_WriteReg(i2c, regs[i].reg, regs[i].val);

////        if (kStatus_Success != status)
////        {
////            break;
////        }
////    }

//    return status;
//}

/**
  * @brief  Resets the OV2640 camera.
  * @param  None
  * @retval None
  */
static status_t OV2640_SoftwareReset(sccb_i2c_t i2c)
{
	/*OV2640有两组寄存器，设置0xFF寄存器的值为0或为1时可选择使用不同组的寄存器*/	
	OV2640_WriteReg(i2c,OV2640_DSP_RA_DLMT, 0x0) ;
	OV2640_WriteReg(i2c,OV2640_SENSOR_COM7, 0x8) ;
	return 0;
}

/**
  * @brief  Resets the OV2640 camera.
  * @param  None
  * @retval None
  */
void OV2640_Reset(void)
{
	/*OV2640有两组寄存器，设置0xFF寄存器的值为0或为1时可选择使用不同组的寄存器*/	
	OV2640_WriteReg(LPI2C1,OV2640_DSP_RA_DLMT, 0x0) ;
	OV2640_WriteReg(LPI2C1,OV2640_SENSOR_COM7, 0x8) ;
}
//extern uint8_t OV2640_FOCUS_AD5820_Init(void);

/**
  * @brief  读取摄像头的ID.
  * @param  OV2640ID: 存储ID的结构体
  * @retval None
  */
void OV2640_ReadID(OV2640_IDTypeDef *OV2640ID)
{		
	uint8_t reg_temp;
	
	uint8_t Manufacturer_ID1;
  uint8_t Manufacturer_ID2;
  uint8_t PIDH;
  uint8_t PIDL;
	
	
	/*OV2640有两组寄存器，设置0xFF寄存器的值为0或为1时可选择使用不同组的寄存器*/
  OV2640_WriteReg(LPI2C1,OV2640_DSP_RA_DLMT, 0x01);
	
	OV2640_ReadReg(LPI2C1,OV2640_SENSOR_MIDH,&Manufacturer_ID1);
	OV2640_ReadReg(LPI2C1,OV2640_SENSOR_MIDL,&Manufacturer_ID2);
	OV2640_ReadReg(LPI2C1,OV2640_SENSOR_PIDH,&PIDH);
	OV2640_ReadReg(LPI2C1,OV2640_SENSOR_PIDL,&PIDL);
	
	/*读取寄存芯片ID*/
  OV2640ID->Manufacturer_ID1 = Manufacturer_ID1;
  OV2640ID->Manufacturer_ID2 = Manufacturer_ID2;
  OV2640ID->PIDH = 							PIDH            ;
  OV2640ID->PIDL = 							PIDL            ;
}
/**
  * @brief  配置OV2640为UXGA模式，并设置输出图像大小
  * @param  None
  * @retval None
  */
void OV2640_UXGAConfig(void)
{
  uint32_t i;
	
	/*摄像头复位*/
  OV2640_Reset();

	/*进行三次寄存器写入，确保配置写入正常
	(在使用摄像头长排线时，IIC数据线干扰较大，必须多次写入来保证正常)*/
  /* 写入寄存器配置 */
  for(i=0; i<(sizeof(OV2640_UXGA)/2); i++)
  {
    OV2640_WriteReg(LPI2C1,OV2640_UXGA[i][0], OV2640_UXGA[i][1]);

  }
	  /* Initialize OV2640 */
  for(i=0; i<(sizeof(OV2640_UXGA)/2); i++)
  {
    OV2640_WriteReg(LPI2C1,OV2640_UXGA[i][0], OV2640_UXGA[i][1]);

  }
	  /* Initialize OV2640 */
  for(i=0; i<(sizeof(OV2640_UXGA)/2); i++)
  {
    OV2640_WriteReg(LPI2C1,OV2640_UXGA[i][0], OV2640_UXGA[i][1]);

  }

//  注释掉的这三个函数未测试
//  OV2640_ImageSize_Set(1600,1200);
//  OV2640_ImageWin_Set(0,0,800,600);
//  OV2640_Window_Set(0,0,800,600);
	
		/*设置输出的图像大小*/
	//  OV2640_OutSize_Set(img_width,img_height);   
}


status_t OV2640_Init(camera_device_handle_t *handle, const camera_config_t *config)
{
    status_t status;
    uint8_t pid, ver;
    uint16_t width, height;
		/*	先初始化SCCB	*/
    ov2640_resource_t *resource = (ov2640_resource_t *)(handle->resource);
    sccb_i2c_t i2c = resource->sccbI2C;

    if ((kCAMERA_InterfaceNonGatedClock != config->interface) && (kCAMERA_InterfaceGatedClock != config->interface) &&
        (kCAMERA_InterfaceCCIR656 != config->interface))
    {
        return kStatus_InvalidArgument;
    }

    width = FSL_VIDEO_EXTRACT_WIDTH(config->resolution);
    height = FSL_VIDEO_EXTRACT_HEIGHT(config->resolution);

    if ((width > 800) || (height > 480))
    {
        return kStatus_InvalidArgument;
    }
		/*	拉高电源引脚	*/
    resource->pullPowerDownPin(true);
		/*	拉低复位引脚	*/
		resource->pullResetPin(false);
    /* 延时 */
    OV2640_DelayMs(1);

    resource->pullPowerDownPin(false);

    /* 延时 */
    OV2640_DelayMs(2);

    resource->pullResetPin(true);

    /* 延时 */
    OV2640_DelayMs(2);

    /* 识别设备 */
    status = OV2640_ReadReg(i2c, 0, &pid);
    if (kStatus_Success != status)
    {
        return status;
    }

    status = OV2640_ReadReg(i2c, 0, &ver);
    if (kStatus_Success != status)
    {
        return status;
    }

//    if (OV2640_REVISION != (((uint32_t)pid << 8U) | (uint32_t)ver))
//    {
//        return kStatus_Fail;
//    }

    /* 设备识别确定, 执行软件复位 */
    OV2640_SoftwareReset(i2c);

    /* 延时 */
    OV2640_DelayMs(2);

		OV2640_UXGAConfig(); 
		
		
//    /* 配置摄像头寄存器 */
//    status = OV2640_WriteRegs(i2c, OV2640InitRegs, ARRAY_SIZE(OV2640InitRegs));
//    if (kStatus_Success != status)
//    {
//        return status;
//    }
		/* 配置摄像头寄存器 */
		OV2640_USER_Config();
		/* 初始化摄像头自动对焦 */
//		OV2640_FOCUS_AD5820_Init();	
		return kStatus_Success;
}

status_t OV2640_Start(camera_device_handle_t *handle)
{
    return kStatus_Success;
}

status_t OV2640_Stop(camera_device_handle_t *handle)
{
    return kStatus_Success;
}

status_t OV2640_InitExt(camera_device_handle_t *handle, const camera_config_t *config, const void *specialConfig)
{
    return OV2640_Init(handle, config);
}
